# Writing a TANGO device class (Python)

Concepts that will be explored:

 * Adding commands
 * Modifying device state
 * Adding attributes
 * Attribute alarm ranges
 * Implications of polling/events

## Writing Python Tango Devices using both classical API and Python HL API

### Exercise 1: Write A Tango Device Server for a Fixed Voltage Power Supply following this specification. (The device is loosely based on the Power Supply device that appears on the PyTango HL documentation).

#### States

 * ON: Output is enabled
 * OFF: Output is disabled (although attributes are readable)
 * RUNNING: A setting is being applied (will make sense in a later exercise)
 
#### Commands

 * On : enables the output, current is calcullated taking voltage and load impedance into account.
 * Off : disables the output, current is 0
 
#### Attributes

 * Voltage : writable by user, needs some time to be updated on HW
 * Current: calcullated by the device when state is ON
 
#### Properties

 * LoadImpedance: DevDouble: in this example it will be the impedance of the load connected to the power supply.
 * HWReadtime: Time needed to change a parameter on HW

## Creating and executing the device

We will launch the Jive application

    cd /usr/src/ska-docker/docker-compose
    make start jive

From there, we will go to "Add new device" in the menu with the following parameters

     Server: PowerSupply/1
     Class: PowerSupply
     Devices: test/ps/1

Now we can launch the device, either locally or using the itango container.
 
### Running the device inside a composer

    cd /usr/src/ska-docker/docker-compose
    
Add these lines to itango.yml

    # sudo gedit itango.yml

    volumes:
      - ${HOME}:/hosthome:rw

Then, launch the container and run the device:

    make start itango
    docker exec -it /hosthome/PowerSupply.py -?

### Running the device in the virtual machine

This option is far more comfortable, but we will not be using nor python3 nor 
the latest versions of packages (not relevant for the training).

   > sudo apt-get update
   > sudo apt install python-tango
   > python PowerSupply.py
